产品需求文档 (PRD): MySQL MCP Server
文档版本	日期	修改人	备注
v1.0	2025-XX-XX	[您的名字]	初始草案
1. 项目概述 (Overview)
1.1 背景
随着 LLM（大语言模型）在开发运维中的应用日益广泛，开发者希望通过自然语言直接与数据库进行交互，进行数据查询、结构分析及基础运维工作。
本项目旨在开发一个基于 Model Context Protocol (MCP) 的 MySQL 服务端，使 Claude、Cursor 等支持 MCP 的客户端能够直接连接、查询和管理 MySQL 数据库。
1.2 目标
构建一个安全、高效的 MySQL MCP Server，支持：
元数据内省：自动获取数据库和表结构信息。
数据交互：支持自然语言转 SQL 的执行（读写分离选项）。
运维管理：支持备份、导出等文件级操作。
2. 用户故事 (User Stories)
作为数据分析师，我希望直接在对话框中询问“查询 user 表中最近注册的 10 个用户”，模型能自动执行 SQL 并返回结果。
作为后端开发，我希望让 AI “查看当前数据库的所有表结构”，以便它帮我生成对应的 ORM 代码。
作为 DBA，我希望通过指令“备份 production 数据库到本地”，快速执行 mysqldump 操作。
作为测试人员，我希望通过指令“导入 test_data.sql”，快速重置测试环境数据。
3. 功能需求 (Functional Requirements)
3.1 连接配置
支持通过环境变量或配置文件设置 MySQL 连接信息（Host, Port, User, Password）。
关键特性：必须支持 READ_ONLY 模式（环境变量控制），防止误删数据。
3.2 核心功能模块
3.2.1 数据库元数据管理
查看数据库列表：列出当前连接用户有权限访问的所有 Databases。
查看数据库版本：返回 MySQL 服务器版本信息 (如 SELECT VERSION())。
查看表列表：指定数据库，列出其中所有 Tables。
查看表结构 (Schema)：获取特定表的 CREATE TABLE 语句或字段类型描述。
3.2.2 数据操作 (DML/DQL)
执行 SQL 语句：
接收 SQL 字符串并执行。
对于 SELECT：返回 JSON 格式的结果集。
对于 INSERT/UPDATE/DELETE：返回受影响的行数。
限制：需设置最大返回行数限制（如默认 100 行），防止 Token 溢出。
3.2.3 运维管理 (Admin)
数据库备份：调用 mysqldump 将指定数据库导出为 SQL 文件保存到本地指定目录。
数据库导出：(同备份，但侧重于导出特定表或结构)。
数据库导入：读取本地 SQL 文件并在指定数据库中执行。
4. MCP 接口定义 (MCP Interface Design)
这是 MCP Server 的核心部分，定义了 LLM 如何调用功能。
4.1 Tools (工具)
LLM 可以主动调用的函数。
工具名称	输入参数 (JSON Schema)	描述
list_databases	{}	列出所有可用数据库名。
get_server_version	{}	获取 MySQL 版本号。
list_tables	{ "database": "string" }	列出指定数据库中的所有表名。
describe_table	{ "database": "string", "table_name": "string" }	获取表的 Schema 信息 (列名、类型、键)。
read_query	{ "query": "string" }	执行 SELECT 查询（只读）。
execute_query	{ "query": "string" }	执行任意 SQL（包括写操作）。需权限控制。
backup_database	{ "database": "string", "output_path": "string" }	备份数据库到服务器本地路径。
import_database	{ "database": "string", "input_path": "string" }	从服务器本地路径导入 SQL 文件。
4.2 Resources (资源)
LLM 可以读取的上下文数据（类似文件读取）。
URI 模式	描述	内容示例
mysql://{host}/databases	所有数据库列表	JSON 列表
mysql://{host}/{db}/schema	整个数据库的 DDL	所有表的 CREATE TABLE 语句集合
mysql://{host}/{db}/{table}/schema	单表 DDL	单表的 CREATE TABLE 语句
4.3 Prompts (预设提示词)
为了让 LLM 更好地使用此工具，可以内置 Prompts。
Prompt: analyze-database
Arguments: database_name
Behavior: 自动调用 list_tables 和 describe_table，并将数据库结构放入上下文，要求 LLM 分析数据模型。
5. 非功能需求 (Non-functional Requirements)
5.1 安全性 (Security)
凭证管理：数据库密码严禁硬编码，必须通过环境变量（如 MYSQL_PASSWORD）传递。
注入防护：虽然主要由 LLM 生成 SQL，但在执行层应尽可能使用参数化查询（针对非动态 SQL 部分），或者在 System Prompt 中告诫 LLM 注意 SQL 注入风险。
危险操作确认：对于 DROP, TRUNCATE 等高危操作，建议在 MCP Server 端增加二次确认逻辑（或直接在 Read-Only 模式下禁用）。
5.2 性能与限制 (Performance & Limits)
上下文限制：查询结果过长时（例如超过 10KB 文本），必须进行截断并在末尾提示“...result truncated”，避免撑爆 LLM 上下文窗口。
超时控制：SQL 执行超时时间设置为 30 秒，防止慢查询阻塞 MCP Server。
5.3 错误处理 (Error Handling)
当 SQL 执行报错时，必须返回清晰的 MySQL 错误信息（Error Code + Message），以便 LLM 能够进行自我修正（Self-Correction）。
6. 技术架构 (Technical Architecture)
开发语言：Python (建议使用 python-sdk for MCP) 或 TypeScript (typescript-sdk)。
数据库驱动：
Python: mysql-connector-python 或 pymysql。
Node: mysql2。
系统依赖：若需支持备份功能，运行环境需安装 mysql-client (包含 mysqldump)。
通信协议：Stdio (标准输入输出) - MCP 默认通信方式。
7. 实施计划 (Implementation Plan)
阶段一：基础查询 (MVP)

实现 MCP Server 框架搭建。

实现数据库连接池。

实现 list_databases, list_tables, read_query 工具。

验证：Claude 可以读取数据。
阶段二：写入与管理

实现 execute_query (DML)。

实现 describe_table (获取详细 Schema)。

完善错误处理机制。
阶段三：高级运维

集成 mysqldump 实现 backup_database。

实现 import_database。

添加 Dockerfile 方便部署。
8. 风险与对策
风险：LLM 幻觉导致生成错误的 SQL（如误删数据）。
对策：默认开启只读模式，写操作需显式开启；建议用户在生产环境慎用 execute_query。
风险：导出大文件导致服务器磁盘满或 IO 阻塞。
对策：检查磁盘空间；限制导出文件大小。
9. 附录：工具调用流程示例
用户输入: "帮我查一下 users 表里有多少人，然后把数据库备份一下。"
MCP 交互流程:
Client -> MCP Server: Call read_query(query="SELECT COUNT(*) FROM users")
MCP Server -> MySQL: Execute SQL.
MySQL -> MCP Server: Returns 542.
MCP Server -> Client: Result [{"COUNT(*)": 542}]
Client (LLM): Parses result, determines next step.
Client -> MCP Server: Call backup_database(database="app_db", output_path="./backup.sql")
MCP Server -> System: Runs mysqldump.
MCP Server -> Client: Returns "Backup successful to ./backup.sql".
Client -> User: "目前 users 表有 542 人，数据库已备份成功。"